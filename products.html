<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>å•†å“ / ä½œå“</title>

<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  margin:0;
  background:#f5f6f8;
  color:#222;
}

.wrapper{
  max-width:1200px;
  margin:40px auto;
  padding:0 20px;
}

/* ===== å…¬å‘Š ===== */
.banner{
  background:#f0f2f5;
  padding:18px;
  border-radius:14px;
  margin-bottom:20px;
  white-space:pre-line;
}

/* ===== æœå°‹ ===== */
.search{
  margin-bottom:20px;
}

.search input{
  width:100%;
  padding:10px 14px;
  border-radius:12px;
  border:1px solid #ddd;
}

/* ===== å•†å“ Grid ===== */
.products{
  display:grid;
  grid-template-columns:repeat(4,1fr); /* å›ºå®šæ¡Œæ©Ÿ4æ¬„ */
  gap:20px;
}

@media(max-width:1024px){
  .products{
    grid-template-columns:repeat(2,1fr);
  }
}

@media(max-width:640px){
  .products{
    grid-template-columns:1fr;
  }
}

/* ===== å¡ç‰‡ ===== */
.card{
  background:#fff;
  border-radius:16px;
  padding:16px;
  box-shadow:0 2px 8px rgba(0,0,0,0.04);
  display:flex;
  flex-direction:column;
}

.card img{
  width:100%;
  border-radius:12px;
  margin-bottom:12px;
}

.title{
  font-weight:700;
  font-size:18px;
  margin-bottom:4px;
}

.sku{
  font-size:13px;
  color:#777;
  margin-bottom:10px;
}

/* ===== åƒ¹æ ¼å€ ===== */
.priceRow{
  display:flex;
  align-items:center;
  gap:8px;
  flex-wrap:wrap;
  margin-bottom:10px;
}

.price{
  font-size:16px;  /* å›ºå®šå­—ç´š */
  padding:6px 10px;
  border-radius:20px;
  font-weight:700;
  white-space:nowrap;
}

.price.normal{
  background:#e8f1ff;
  color:#1967d2;
}

.price.old{
  text-decoration:line-through;
  font-size:13px;
  color:#999;
  padding:0;
}

.price.special{
  background:#ffe9e9;
  color:#d93025;
}

/* ===== å…§æ–‡ ===== */
.spec,
.options{
  font-size:13px;
  color:#555;
  margin-bottom:4px;
}

/* ===== æŒ‰éˆ• ===== */
.btn{
  margin-top:auto;
  background:#1a73e8;
  color:#fff;
  border:none;
  border-radius:12px;
  padding:8px 12px;
  cursor:pointer;
  font-size:14px;
}

</style>
</head>

<body>
<div class="wrapper">

<h2>å•†å“ / ä½œå“</h2>

<div id="banner" class="banner"></div>

<div class="search">
  <input id="searchInput" placeholder="æœå°‹ï¼šåç¨± / ç·¨è™Ÿ / é—œéµå­—...">
</div>

<div id="products" class="products"></div>

</div>

<script>
const SHEET_ID = "1CFUndaTaa_idLh82JxHp6AXCWPTAUFM8AzGW9NIryIA";
const BASE = `https://opensheet.elk.sh/${SHEET_ID}`;

async function loadPublic(){
  const res = await fetch(BASE + "/Public");
  const data = await res.json();
  const banner = data.find(r => r.enabled === "TRUE");
  if(banner){
    document.getElementById("banner").innerText = banner.content || "";
  }
}

function parseOptions(text){
  if(!text) return "";
  let output="";
  const groups=text.split(";");
  groups.forEach(g=>{
    if(!g.trim()) return;
    const [label,values]=g.split(":");
    if(!values) return;
    const items=values.split("|").map(v=>{
      const [name,price]=v.split("=");
      return price && price!="0" ? `${name}(+${price})` : name;
    });
    output+=`${label}ï¼š${items.join("ã€")} `;
  });
  return output.trim();
}

async function loadProducts(){
  const res = await fetch(BASE + "/Products");
  const data = await res.json();

  const container=document.getElementById("products");
  container.innerHTML="";

  data
  .filter(r=>r.enabled==="TRUE")  // åªèª TRUE
  .forEach(r=>{
    const card=document.createElement("div");
    card.className="card";

    let basePrice=parseFloat(r.price||0);
    let specialPrice=parseFloat(r.price_override||0);

    let priceHTML="";

    if(specialPrice){
      priceHTML=`
        <div class="priceRow">
          <div class="price old">NT$ ${basePrice}</div>
          <div class="price special">ğŸ”¥ ç‰¹åƒ¹ NT$ ${specialPrice}</div>
        </div>
      `;
    }else{
      priceHTML=`
        <div class="priceRow">
          <div class="price normal">NT$ ${basePrice}</div>
        </div>
      `;
    }

    card.innerHTML=`
      <img src="${r.image_url}" alt="">
      <div class="title">${r.name}</div>
      <div class="sku">ç·¨è™Ÿï¼š${r.sku}</div>
      ${priceHTML}
      ${r.spec?`<div class="spec">è¦æ ¼ï¼š${r.spec}</div>`:""}
      ${r.options?`<div class="options">${parseOptions(r.options)}</div>`:""}
      <button class="btn">æŸ¥çœ‹ / é¸é …</button>
    `;

    container.appendChild(card);
  });
}

document.getElementById("searchInput").addEventListener("input",e=>{
  const keyword=e.target.value.toLowerCase();
  document.querySelectorAll(".card").forEach(card=>{
    card.style.display=card.innerText.toLowerCase().includes(keyword)?"":"none";
  });
});

loadPublic();
loadProducts();
</script>

</body>
</html>

