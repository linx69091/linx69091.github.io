// ✅ 兼容舊版本購物車 key，並自動遷移到 CART_V1
const CART_KEY = "CART_V1";
const LEGACY_CART_KEYS = ["CART", "cart", "CART_ITEMS", "CART_V0"];

function readCart(){
  // 先讀新 key
  try{
    const v = localStorage.getItem(CART_KEY);
    if(v) return JSON.parse(v) || [];
  }catch(e){}

  // 再嘗試舊 key
  for(const k of LEGACY_CART_KEYS){
    try{
      const v = localStorage.getItem(k);
      if(!v) continue;
      const parsed = JSON.parse(v) || [];
      if(Array.isArray(parsed) && parsed.length){
        // 遷移到新 key
        localStorage.setItem(CART_KEY, JSON.stringify(parsed));
        return parsed;
      }
    }catch(e){}
  }
  return [];
}

function writeCart(items){
  localStorage.setItem(CART_KEY, JSON.stringify(items || []));
}
